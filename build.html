<!DOCTYPE html>
<html lang="en">
<head>
    <title>Showdown Guide</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="keywords" content="naraka bladepoint, showdown, campaign, pve, omnious, guide, guides, naraka, souljades, 
        defuse, aegis, sense, progression, leveling, recasting, converting, conversion, dps, build, builds">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Primary Meta Tags -->
    <meta name="title" content="Naraka Bladepoint Showdown Guide">
    <meta name="description" content="A Guide to Setting Up Builds in Showdown.">
    <meta name="author" content="xZer0x">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dark-zer0.github.io/Showdown/">
    <meta property="og:title" content="Naraka Bladepoint Showdown Guide">
    <meta property="og:description" content="A guide designed to help players progress in Naraka's Campaign mode.">
    <meta property="og:image" content="https://dark-zer0.github.io/Showdown/img/site/banner3.jpg">

    <!-- Twitter / Discord -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://dark-zer0.github.io/Showdown/">
    <meta property="twitter:title" content="Naraka Bladepoint Showdown Guide">
    <meta property="twitter:description" content="A guide designed to help player progression in Naraka's Campaign mode.">
    <meta property="twitter:image" content="https://dark-zer0.github.io/Showdown/img/site/banner3.jpg">

    <!-- Website -->
    <link rel="shortcut icon" type="image/x-icon" href="img/site/icon.png">
    <link rel="icon" href="img/site/icon.png" type="images" sizes="32x32"> 
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet"> 
    <script src="https://kit.fontawesome.com/6d78549c29.js" crossorigin="anonymous"></script>
    <link href="styles.css" rel="stylesheet">
    <script src="src/navbar.js"></script>
    <script src="src/contents.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <div id="navbar"></div>
    <script>
        fetch('navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            });
    </script>

    <!-- Title -->
    <h1 id="title">BUILDS</h1>

    <!-- Return to Top Button -->
    <button type="button" id="back-to-top" title="Go to top of page">
        <img src="img/site/uparrow.png" alt="Up arrow">
    </button>

    <!-- Definitions Section -->
    <div id="definitions" class="definitions-section">
        <h2>Glossary</h2>
        <div class="definition-grid">
            <div class="definition-item">
                <h4>Skill Floor</h4>
                <p>How easy the build is to pick up and use effectively with minimal practice</p>
            </div>
            <div class="definition-item">
                <h4>Skill Ceiling</h4>
                <p>The skill level needed to master this build</p>
            </div>
            <div class="definition-item">
                <h4>Single-Target</h4>
                <p>Effectiveness against 1 enemy (Bossing potential)</p>
            </div>
            <div class="definition-item">
                <h4>Multi-Target</h4>
                <p>Effectiveness against multiple enemies (Mobbing potential)</p>
            </div>
        </div>
        <p><strong>Normal, Hard, Nightscream</strong> & <strong>Topaz</strong> denote the minimum difficulty required for a Souljade to drop.
        With Topaz meaning it only drops from Enigma Domain or other missions that can drop all Souljades (i.e. Tempered Inferno ‚Ä¢ Nightscream).</p>
    </div>

    <!-- Table of Contents -->
    <nav id="toc-container" class="toc-container modern-toc">
        <div class="toc-header">
            <span>üìö</span>
            <span>Build Directory</span>
        </div>
        <div id="toc-list" class="toc-list modern-toc-list"></div>
    </nav>

    <!-- Page Content -->
    <div id="content" class="nav3">
        <div id="div1" class="content">
            <div id="builds" class="builds-grid"></div>
            <div id="error"></div>

            <script>
                // Souljade image path generation
                function getShapeImage(shape, rarity) {
                    const rarityColor = rarity === 'Legendary' ? 'Gold' : 'Purple';
                    return `img/builds/souljades/${shape}_${rarityColor}.png`;
                }

                function extractShapeFromImage(imagePath) {
                    if (!imagePath) return 'Triangle';
                    const filename = imagePath.split('/').pop();
                    const shape = filename.split('_')[0];
                    return shape || 'Triangle';
                }

                // TSV parsing for additional souljade data
                function parseTSV(tsvText) {
                    const lines = tsvText.trim().split('\n');
                    if (lines.length < 2) return {};
                    
                    const headers = lines[0].split('\t');
                    const nameIndex = headers.findIndex(h => h.toLowerCase().includes('souljade') || h.toLowerCase().includes('name'));
                    const effectIndex = headers.findIndex(h => h.toLowerCase().includes('effect') || h.toLowerCase().includes('description'));
                    const shapeIndex = headers.findIndex(h => h.toLowerCase().includes('shape'));
                    const rarityIndex = headers.findIndex(h => h.toLowerCase().includes('rarity'));
                    const difficultyIndex = headers.findIndex(h => h.toLowerCase().includes('difficulty'));
                    
                    const souljadeMap = {};
                    for (let i = 1; i < lines.length; i++) {
                        const columns = lines[i].split('\t');
                        if (columns.length > nameIndex && columns[nameIndex]) {
                            const name = columns[nameIndex].trim();
                            if (name) {
                                souljadeMap[name] = {
                                    effect: effectIndex !== -1 && columns[effectIndex] ? columns[effectIndex].trim() : '',
                                    shape: shapeIndex !== -1 && columns[shapeIndex] ? columns[shapeIndex].trim() : '',
                                    rarity: rarityIndex !== -1 && columns[rarityIndex] ? columns[rarityIndex].trim() : 'Legendary',
                                    difficulty: difficultyIndex !== -1 && columns[difficultyIndex] ? columns[difficultyIndex].trim() : ''
                                };
                            }
                        }
                    }
                    return souljadeMap;
                }

                // Difficulty mapping
                function getDifficultyClass(difficulty) {
                    const difficultyMap = {
                        'Commemorative': 'commemorative',
                        'Any': 'normal',
                        'Hard': 'hard',
                        'Topaz': 'topaz',
                        'Nightscream': 'nightscream'
                    };
                    return difficultyMap[difficulty] || 'normal';
                }

                // Generate star ratings
                function generateStars(rating) {
                    let stars = '';
                    const filledStars = Math.floor(rating);
                    const hasHalfStar = rating % 1 !== 0;
                    
                    for (let i = 1; i <= 5; i++) {
                        if (i <= filledStars) {
                            stars += `<img src="img/site/filledstar.png" alt="Filled Star" class="icon">`;
                        } else if (i === filledStars + 1 && hasHalfStar) {
                            stars += `<img src="img/site/halffilledstar.png" alt="Half-Filled Star" class="icon">`;
                        } else {
                            stars += `<img src="img/site/unfilledstar.png" alt="Empty Star" class="icon">`;
                        }
                    }
                    return stars;
                }

                // Generate build card
                function renderBuild(build, souljadeDataMap, index) {
                    const anchorId = build.name.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
                    
                    return `
                        <div class="build-card ${build.type}" id="${anchorId}" data-build-id="${index}">
                            <div class="build-header">
                                <div class="build-title-section">
                                    <div class="build-name">
                                        ${build.name}
                                        <span class="build-type-badge ${build.type}">${build.type}</span>
                                    </div>
                                    <div class="difficulty-rating">
                                        <div class="rating-item">
                                            <span class="rating-label">Skill Floor:</span>
                                            <div class="rating-value">${generateStars(build.difficulty.skillFloor)}</div>
                                        </div>
                                        <div class="rating-item">
                                            <span class="rating-label">Skill Ceiling:</span>
                                            <div class="rating-value">${generateStars(build.difficulty.skillCeiling)}</div>
                                        </div>
                                    </div>
                                    <div class="power-rating">
                                        <div class="power-item single-target">
                                            <span class="rating-label">Single-Target:</span>
                                            <div class="power-bar"><div class="power-fill" style="width: ${(build.power.singleTarget / 5) * 100}%"></div></div>
                                            <span>${build.power.singleTarget}/5</span>
                                        </div>
                                        <div class="power-item multi-target">
                                            <span class="rating-label">Multi-Target:</span>
                                            <div class="power-bar"><div class="power-fill" style="width: ${(build.power.multiTarget / 5) * 100}%"></div></div>
                                            <span>${build.power.multiTarget}/5</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="build-section">
                                <div class="section-title">üìñ Build Description</div>
                                <div class="section-content">
                                    <p>${build.description}</p>
                                </div>
                            </div>

                            <div class="build-section">
                                <div class="section-title">ü¶∏ Recommended Heroes</div>
                                <div class="section-content">
                                    <div class="heroes-list">
                                        ${build.recommendedHeroes.map(hero => `<div class="hero-tag">${hero}</div>`).join('')}
                                    </div>
                                </div>
                            </div>

                            <div class="build-section">
                                <div class="section-title">üíé Souljades</div>
                                <div class="section-content">
                                    <div class="souljades-grid">
                                        ${build.souljades.map(souljade => {
                                            const tsvData = souljadeDataMap[souljade.name] || {};
                                            const shape = tsvData.shape || extractShapeFromImage(souljade.image);
                                            const rarity = tsvData.rarity || 'Legendary';
                                            const difficulty = tsvData.difficulty || souljade.difficulty || 'Any';
                                            const description = tsvData.effect || souljade.description || '';
                                            const difficultyClass = getDifficultyClass(difficulty);
                                            const imagePath = getShapeImage(shape, rarity);
                                            
                                            return `
                                                <div class="souljade-card ${difficultyClass}">
                                                    <div class="souljade-header">
                                                        <div class="souljade-name">${souljade.name}</div>
                                                        <div class="souljade-difficulty">${difficulty}</div>
                                                    </div>
                                                    <div class="souljade-image">
                                                        <img src="${imagePath}" alt="${souljade.name}">
                                                    </div>
                                                    <div class="souljade-description">${description}</div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>

                            <div class="build-section">
                                <div class="section-title">üìä Potential Plan</div>
                                <div class="section-content">
                                    <img src="${build.potentialPlan.image}" alt="${build.potentialPlan.alt}" class="potential-plan">
                                </div>
                            </div>

                            <div class="build-section">
                                <div class="section-title">‚öîÔ∏è Wielding Types</div>
                                <div class="section-content">
                                    <div class="wielding-types">
                                        ${build.wieldingTypes.map(wt => `
                                            <div class="wielding-item">
                                                <div class="wielding-icon ${wt.name.toLowerCase().includes('ice') ? 'ice' : wt.name.toLowerCase().includes('poison') ? 'poison' : 'thunder'}">${wt.count}</div>
                                                <span>${wt.name}</span>
                                                <img src="${wt.image}" alt="${wt.name}" class="wielding">
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>

                            <div class="build-section">
                                <div class="section-title">üéØ Attribute Priority</div>
                                <div class="section-content">
                                    <div class="attributes-grid">
                                        <div class="attribute-column">
                                            <div class="attribute-title">Target Attributes</div>
                                            <div class="attribute-list">
                                                ${build.souljadeAttributes.target.map(attr => `<div class="attribute-tag">${attr}</div>`).join('')}
                                            </div>
                                        </div>
                                        <div class="attribute-column">
                                            <div class="attribute-title">Placeholder Attributes</div>
                                            <div class="attribute-list">
                                                ${build.souljadeAttributes.placeholder.map(attr => `<div class="attribute-tag placeholder-tag">${attr}</div>`).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="build-section hidden-section">
                                <div class="section-title">üîÆ Curios</div>
                                <div class="section-content">
                                    <div class="curios-grid">
                                        ${build.curios.map(curio => `
                                            <div class="curio-card">
                                                <div class="curio-header">
                                                    <div class="curio-name">${curio.name}</div>
                                                </div>
                                                <div class="curio-description">${curio.description}</div>
                                                ${curio.awakening ? `<div class="curio-awakening"><strong>Awakening:</strong> ${curio.awakening}</div>` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>

                            <div class="build-section hidden-section">
                                <div class="section-title">üî• Curio Attributes</div>
                                <div class="section-content">
                                    <div class="attributes-grid">
                                        <div class="attribute-column">
                                            <div class="attribute-title">Yang Attributes</div>
                                            <div class="attribute-list">
                                                ${build.curioAttributes.yang.map(attr => `<div class="attribute-tag">${attr}</div>`).join('')}
                                            </div>
                                        </div>
                                        <div class="attribute-column">
                                            <div class="attribute-title">Yin Attributes</div>
                                            <div class="attribute-list">
                                                ${build.curioAttributes.yin.map(attr => `<div class="attribute-tag placeholder-tag">${attr}</div>`).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Generate TOC
                function generateTOC(builds) {
                    const tocList = document.getElementById('toc-list');
                    tocList.innerHTML = builds.map((build, index) => {
                        const anchorId = build.name.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
                        const displayName = build.name.replace(/‚Ä¢/g, '-');
                        return `
                            <div class="toc-item" data-index="${index}">
                                <a href="#${anchorId}" class="toc-link ${build.type}">${displayName}</a>
                                <span class="toc-item-type type-${build.type}">${build.type}</span>
                            </div>
                        `;
                    }).join('');

                    // Add smooth scrolling
                    document.querySelectorAll('.toc-link').forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const targetId = this.getAttribute('href').substring(1);
                            const targetElement = document.getElementById(targetId);
                            if (targetElement) {
                                targetElement.scrollIntoView({ 
                                    behavior: 'smooth', 
                                    block: 'start' 
                                });
                            }
                        });
                    });
                }

                // Load builds
                async function loadBuilds() {
                    const buildsContainer = document.getElementById('builds');
                    const errorContainer = document.getElementById('error');
                    
                    try {
                        const response = await fetch('builds.json');
                        if (!response.ok) {
                            throw new Error(`Failed to load builds.json: ${response.statusText}`);
                        }
                        const builds = await response.json();
                        
                        let souljadeDataMap = {};
                        try {
                            const tsvResponse = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1pJNzFcZGVidnY3bAvSiO77YxZTMwgksO-BO7cnNAWoXuOlTYTXqMHbWkpARNn6H4Gr4tuRfSoe4T/pub?gid=2037803523&single=true&output=tsv');
                            if (tsvResponse.ok) {
                                const tsvText = await tsvResponse.text();
                                souljadeDataMap = parseTSV(tsvText);
                            }
                        } catch (tsvError) {
                            console.warn('TSV loading failed:', tsvError.message);
                        }
                        
                        generateTOC(builds);
                        buildsContainer.innerHTML = builds.map((build, index) => 
                            renderBuild(build, souljadeDataMap, index)
                        ).join('');

                        // Smooth scrolling for TOC links only
                        document.querySelectorAll('.toc-link').forEach(link => {
                            link.addEventListener('click', function(e) {
                                e.preventDefault();
                                const targetId = this.getAttribute('href').substring(1);
                                const targetElement = document.getElementById(targetId);
                                if (targetElement) {
                                    targetElement.scrollIntoView({ 
                                        behavior: 'smooth', 
                                        block: 'start' 
                                    });
                                }
                            });
                        });
                        
                    } catch (error) {
                        errorContainer.innerHTML = `<p class="error">Error loading builds: ${error.message}</p>`;
                    }
                }

                document.addEventListener('DOMContentLoaded', loadBuilds);

                // Keep existing description toggle functionality
                document.addEventListener('click', function(e) {
                    if (e.target.closest('.toggled-description')) {
                        const item = e.target.closest('.toggled-description');
                        document.querySelectorAll('.toggled-description').forEach(el => {
                            if (el !== item) el.classList.remove('show');
                        });
                        item.classList.toggle('show');
                        e.stopPropagation();
                    } else {
                        document.querySelectorAll('.toggled-description').forEach(el => el.classList.remove('show'));
                    }
                });
            </script>
        </div>
    </div>

    <!-- Keep your existing return.js -->
    <script src="src/return.js"></script>
</body>
</html>